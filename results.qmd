# Results

## Data processing

Here are packages we used in the project:

```{r}
library(dplyr)
library(ggplot2)
library(lubridate)
library(leaflet)
library(knitr)
library(ggalluvial)
```

In the previous section, we checked that the missing values were primarily concentrated in columns like `Crm Cd 4`, `Crm Cd 3`, and `Crm Cd 2`. But here to prevent the very small amount of missing value that would influence the graph visualizations, we removed all missing entries from the key columns that we will analyze further.

```{r}
# Dataset Loading
file_path <- "../../data/Crime_Data_from_2020_to_Present.csv"
crime_data <- read.csv(file_path)

crime_data <- crime_data |>
  filter(!is.na(Crm.Cd.1)) |> 
  filter(!is.na(Crm.Cd.Desc))
```

## 5.1 Patterns and trend of Specific Types of Crimes

### 5.1.1 How has the seriousness of crimes evolved over the years?

From the data records in variable `Crm Cd 1` where a series crime class number were recorded for each committed crime, we can construct a bar chart showing the amount of crime across different seriousness over years. According to [Explanation of this dataset from Los Angeles Police Department](https://data.lacity.org/Public-Safety/Crime-Data-from-2020-to-Present/2nrs-mtv8/about_data), the lower class number indicate more serious case.

```{r}
# Convert date and get year data
crime_data$DATE_OCC <- as.Date(crime_data$DATE.OCC, format="%m/%d/%Y")
crime_data$Year <- year(crime_data$DATE_OCC)

# Group seriousness
crime_data$Crm.Cd.1.Class <- floor(crime_data$Crm.Cd.1 / 100) * 100

# Group by Year and Crm Cd 1 Class, and count frequency
seriousness_by_year <- crime_data |>
  group_by(Year, Crm.Cd.1.Class) |>
  summarize(Count = n(), .groups = "drop")

ggplot(seriousness_by_year, aes(x = factor(Year), y = Count, fill = factor(Crm.Cd.1.Class))) +
  geom_bar(stat = "identity", position = "dodge", color = "black") +
  labs(title = "Crime Seriousness Trends Over Years",
       x = "Year",
       y = "Frequency",
       fill = "Crime Class (Grouped)") +
  theme(axis.text.x = element_text(angle = 45))
```

From the graph, we can observe that extreme cases of small crimes and large crimes consistently tend to have a rather low frequency, likely due to their rarity. Although there are some variations in the number of crimes across different seriousness levels over the five years, the dominance of crime class 300 implies that crimes with moderate seriousness, such as robbery, are more common in LA.

The bar chart also shows a dramatic decrement in crime in 2021 compared to 2020, followed by a relative increment in 2022 and 2023. Based on the context, the decrease in crimes could have been influenced by the quarantine policies during COVID-19 start from the end of 2020 to 2021. Later, as people returned to normal life and the economy recovered, the number of crimes also returned to a more consistent pattern. And the overall lower number of crimes in 2024 might be cause by the incomplete data.

But apart from external factors (like economy), the pattern of crime seriousness seems to be quite stable over years.

### 5.1.2 Which crime types are most prevalent?

Next, we can try to verify our insight from question 5.1.1 by examining the types of prevalent crimes. `Crm Cd Desc` records a series of detailed description of the committed crime. However, since these descriptions are highly specific, we group them by key words to make 9 broader categories to present the data more effectively for analysis.

```{r}
# Define the groups for crime types
grouped_data <- crime_data |>
  mutate(Crime.Category = case_when(
    grepl("ASSAULT|BATTERY|ABUSE", Crm.Cd.Desc, ignore.case = TRUE) ~ "Assault",
    grepl("THEFT|STOLEN", Crm.Cd.Desc, ignore.case = TRUE) ~ "Theft",
    grepl("BURGLARY|SHOPLIFTING", Crm.Cd.Desc, ignore.case = TRUE) ~ "Burglary",
    grepl("SEX|RAPE|ORAL", Crm.Cd.Desc, ignore.case = TRUE) ~ "Sex Offenses",
    grepl("GRAFFITI|DAMAGE", Crm.Cd.Desc, ignore.case = TRUE) ~ "Graffiti",
    grepl("FRAUD|BUNCO|FORGERY|UNAUTHORIZED|EXTORTION", Crm.Cd.Desc, ignore.case = TRUE) ~ "Fraud/Financial Crimes",
    grepl("RESTRAINING|PHONE CALLS|THREATENING|LETTER", Crm.Cd.Desc, ignore.case = TRUE) ~ "Public Order Crimes",
    grepl("WEAPON", Crm.Cd.Desc, ignore.case = TRUE) ~ "Weapon",
    grepl("VANDALISM|FELONY", Crm.Cd.Desc, ignore.case = TRUE) ~ "Felony",
    TRUE ~ "Other(e.g., Arson)"
  ))

# Summarize
crime_summary <- grouped_data |>
  group_by(Crime.Category) |>
  summarize(Frequency = n(), .groups = "drop") |>
  arrange(Frequency)

ggplot(crime_summary, aes(x = reorder(Crime.Category, Frequency), y = Frequency, fill = Frequency)) +
  geom_bar(stat = "identity", color = "black") +
  coord_flip() + # Flip the coordinates for horizontal bars
  labs(title = "Frequency of Crime Categories",
       x = "Crime Category",
       y = "Frequency",
       fill = "Frequency") +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  theme(axis.text.x = element_text(size = 11), axis.text.y = element_text(size = 10))
```

We also include an alluvial graph here to highlight the distribution of crime seriousness levels for various crime types we defined above. But for better visualization, we exclude the 3 less frequent crime types.

```{r}
# Exclude 3 less frequent crime types
filtered_data <- grouped_data |> 
  filter(!Crime.Category %in% c("Fraud/Financial Crimes", "Graffiti", "Sex Offenses")) |>
  group_by(Crime.Category, Crm.Cd.1.Class) |>
  summarize(Frequency = n(), .groups = "drop")

filtered_data$Crm.Cd.1.Class <- as.factor(filtered_data$Crm.Cd.1.Class)

# Recode category for better visualization
filtered_data$Crime.Category <- recode(filtered_data$Crime.Category,
                                       "Other(e.g., Arson)" = "Other Crimes",
                                       "Public Order Crimes" = "Public Order")

ggplot(filtered_data,
       aes(axis1 = Crime.Category, axis2 = Crm.Cd.1.Class, y = Frequency)) +
  geom_alluvium(aes(fill = Crm.Cd.1.Class), width = 1/8, color = "black") +
  geom_stratum(width = 1/6, fill = "white", color = "black") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 2.5) +
  scale_fill_brewer(type = "qual", palette = "Set3") +
  labs(title = "Distribution of Crime Seriousness Across Crime Types",
       x = "Crime Types                                                    Seriousness Levels",
       y = "Frequency",
       fill = "Crime Class") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45)) +
  theme(
    axis.text.x = element_blank(),
    axis.text.y = element_blank()
  )
```

Based on the frequecy list, it is obvious that most prevalent record cases are theft related crimes. This seems to align with the insight from the previous question, where crimes of moderate seriousness were shown to be the most prevalent. And our alluvial graph also indicate the same idea.

Theft and burglary, which are less violent but common crime, are reasonably belong to crime class 300-500. This can also proved by the alluvial graph where theft crime have cases from seriousness 300-500 and burglary mainly consist by cases from seriousness class 300.

Then we can see assault, including battery and abuse, also take a great proportion of total recorded crimes. It is not surprising for this result as disputes with homeless people and mental illness are not uncommon in Los Angeles. What's interesting is that assault consist cases from both seriousness class 600 and 300. This might depends on the type of assault that being conducted.

On the contrary, fraud/financial crime and graffiti are less often to be caught. It could because it is harder to caught those suspects. But overall they represent more specific or severe cases that occur in smaller numbers.

### 5.1.3 Where do this specific types of crimes occur most frequently?

Before we dive into this question, let's see how may distinct areas are recorded in this data set.

```{r}
grouped_data |>
  distinct(AREA, AREA.NAME) |>
  arrange(AREA) |>
  kable(col.names = c("Area Code", "Area Name"), align = "c")
```

So it turns out that there are 21 areas here. Let's take the top 2 common crime type from our previous result and investigate where do they usually happened. Since the top 2 crime type are theft and assault, we filter them separately on the data set while group by area name to make two interactive maps for difference comparison.

```{r}
# Filter Theft category
theft_geo_map <- grouped_data |>
  filter(Crime.Category == "Theft") |>
  group_by(AREA.NAME) |>
  summarize(Frequency = n(), Latitude = mean(LAT), Longitude = mean(LON), .groups = "drop")

leaflet(data = theft_geo_map) |>
  addTiles() |>
  addCircleMarkers(
    lng = ~Longitude, lat = ~Latitude,
    radius = ~sqrt(Frequency) / 5,
    color = ~colorNumeric(palette = "Purples", domain = theft_geo_map $Frequency)(Frequency),
    fillColor = ~colorNumeric(palette = "Purples", domain = theft_geo_map $Frequency)(Frequency),
    fillOpacity = 0.7,
    popup = ~paste("<b>Area:</b>", AREA.NAME, "<br>", "<b>Frequency:</b>", Frequency)
  ) |>
  addLegend(
    "bottomright", 
    pal = colorNumeric("Purples", domain = theft_geo_map$Frequency),
    values = ~Frequency, 
    title = "Theft Frequency",
    opacity = 1
  ) |> 
  addControl(
    html = "<h3>Theft Crime in LAs</h3>",
    position = "topright"
  )
```

For the theft frequency map, it shows that most areas have similar theft cases overall. However, some regions like Pacific, Southwest, Central, and even N. Hollywood display higher frequencies compared to others. We assume that the prevalence of theft crimes in these areas could be caused by tourist attractions and more active commercial activities. With crowds providing cover, thefts can more easily commit crimes. Meanwhile, areas like Foothill and Hollenbeck, which are labeled with lighter colors on the map, indicate lower theft crimes These places are more residential, located farther from economically developed regions, and have sparser populations. Consequently, theft crimes are less frequent in these areas.

This observation suggests that the judicial department should deploy more police forces to economically developed and densely populated areas to safeguard people's property and reduce the high number of theft incidents.

```{r}
# Filter Assault category
assault_geo_map  <- grouped_data |>
  filter(Crime.Category == "Assault") |>
  group_by(AREA.NAME) |>
  summarize(Frequency = n(), Latitude = mean(LAT), Longitude = mean(LON), .groups = "drop")

leaflet(data = assault_geo_map) |>
  addTiles() |>
  addCircleMarkers(
    lng = ~Longitude, lat = ~Latitude,
    radius = ~sqrt(Frequency) / 5,
    color = ~colorNumeric(palette = "Purples", domain = assault_geo_map $Frequency)(Frequency),
    fillColor = ~colorNumeric(palette = "Purples", domain = assault_geo_map $Frequency)(Frequency),
    fillOpacity = 0.7,
    popup = ~paste("<b>Area:</b>", AREA.NAME, "<br>", "<b>Frequency:</b>", Frequency)
  ) |>
  addLegend(
    "bottomright", 
    pal = colorNumeric("Purples", domain = assault_geo_map $Frequency),
    values = ~Frequency, 
    title = "Assault Frequency",
    opacity = 1
  ) |> 
  addControl(
    html = "<h3>Assault Crime in LA</h3>",
    position = "topright"
  )

```

From the map of assault crime frequency, it shows that areas such as 77th Street, Southeast, and Central have higher frequencies of assault crimes compared to other regions. These areas overlap with regions where more theft crimes occur, and they also share features such as more prosperous commerce and higher population density. In contrast, areas farther from the central region seem to experience fewer assault crimes. Residents in these areas are more likely to be peaceful locals.

So we can infer that factors contributing to higher crime rates for both theft and assault could include economic conditions, living challenges, and population density. Areas with high populations but insufficient police resources may face higher crime rates. Assault frequencies tend to be higher in city centers, transportation hubs, and entertainment areas, where interactions and conflicts are more likely to occur.

### 5.1.4 When are top 4 specific crimes most likely to occur?

Now we have some insights into the patterns and factors influencing specific types of crime, we try to provide more accurate suggestions for interventions. To achieve this, it is important to also take a look on how time factors might affect crime patterns further.

We pick the top 4 crime types and examine how their frequency varies on different months and times of the day.

```{r}
# Filter the top 4 crimes on desc(frequency)
top_4_crimes <- grouped_data |> 
  count(Crime.Category) |>
  arrange(desc(n)) |>
  slice(1:4) |>
  pull(Crime.Category)

# Mutate columns for mouth and hour data
top_crimes_data <- grouped_data |>
  filter(Crime.Category %in% top_4_crimes) |>
  mutate(
    Month = format(as.Date(DATE_OCC), "%B"),
    Hour = as.integer(TIME.OCC / 100)
  )


monthly_data <- top_crimes_data |>
  group_by(Month, Crime.Category) |>
  summarize(Count = n(), .groups = "drop") |>
  mutate(Month = factor(Month, levels = month.name))

# Plot 1: Monthly
ggplot(monthly_data, aes(x = Month, y = Count, group = Crime.Category, color = Crime.Category)) +
  geom_line(linewidth = 1) +
  geom_point(linewidth = 2) +
  labs(
    title = "Crime Occurrences by Month",
    x = "Month",
    y = "Frequency",
    color = "Crime Type"
  ) +
  theme(axis.text.x = element_text(angle = 45))
```

From the monthly graph, it is not surprising to see that theft remains a year-round common crime. However, the trend shows a slight decrease from the beginning of the year to the end. The fluctuation in assault frequency is smaller, with a noticeable decrease in November and December, which might be influenced by the holiday season. In addition, both burglary and other crimes exhibit stable trends, suggesting their frequencies are not significantly affected by season or month.

Overall, while certain types of crimes show sightly variations in frequency across different months, the monthly graph indicates that there isn't a strong relationship between month and crime rate.

```{r}
hourly_data <- top_crimes_data |>
  group_by(Hour, Crime.Category) |>
  summarize(Count = n(), .groups = "drop")

# Plot 2: Hourly
ggplot(hourly_data, aes(x = Hour, y = Count, group = Crime.Category, color = Crime.Category)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "Crime Occurrences by Hour",
    x = "Hour of the Day",
    y = "Frequency",
    color = "Crime Type"
  )
```

The hour graph also provides some interesting insights. Theft crimes show a dramatic increase during the morning period, especially between 6 AM and 12 PM, and gradually decrease from 6 PM to the early morning of next day. This pattern aligns with opportunities for theft when people are commuting to or from work. Assaults increase during the daytime and decline after 9 PM, which might related to social interactions in public spaces during the day. Burglary shows slightly higher occurrences in the evening hours, as criminals often rely on the cover of darkness. And other crimes remain consistent throughout the day.

Compared to the monthly graph, the hour graph gives us more valuable insights about how time influences crime patterns. The morning period is the peak for theft and assault crimes, which might due to commuting traffic and crowded public spaces. The evening is the peak for burglaries. Based on these observations, we recommend strengthening public security by increasing police presence in high-traffic areas during morning rush hours and enhancing security in residential areas in night time to reduce burglary cases.
